/*!
 * AjaxDropDown v1.2.1 | Pawel Bizley Brzozowski | https://github.com/bizley-code/Yii2-AjaxDropDown
 */
!function(a){a.fn.ajaxDropDown=function(e){var n=a.extend(!0,{addc:"",dely:300,ercl:"",erst:"",hecl:"",hest:"",keyt:!0,locl:"",lost:"",mabe:"",maen:"",minq:0,name:"ajaxDropDown",nebe:"",necl:"",neen:"",nest:"",nrcl:"",nrst:"",onrm:"",onsl:"",pabe:"",paen:"",prbe:"",prcl:"",pren:"",prst:"",prba:"",recl:"",rest:"",rmcl:"",rmla:"",rmst:"",rscl:"",rsst:"",smbt:!1,smod:!1,swcl:"",swst:"",url:"",loca:{allr:"All records",rcon:"Records containing",mcha:"Type at least {NUM} character(s) to filter the results...",erro:"Error",prev:"prev",next:"next",nrec:"No matching records found"}},e),t="active",r=" ajaxDropDownRecord",l="</a></li>",s="a.ajaxDropDownNext",o="a.ajaxDropDownPrev",d="button.ajaxDropDownSingleRemove",p="button.ajaxDropDownToggle",c='><a href="#" class="ajaxDropDownResult" data-id="',f="disabled",v="hidden",D="input[type=text]",h="</li>",m='<li class="dropdown-header',u="li.ajaxDropDownPage",g="li.ajaxDropDownPages",w='<li class="ajaxDropDownPages ajaxDropDownPage',x="li.ajaxDropDownSelected",j="span.ajaxDropDownPageNumber",b=' style="',C="ul.ajaxDropDownMenu",y=null,k=[],P=new Function("id","selection",n.onrm),R=new Function("id","label","selection",n.onsl),N=function(a){var e=[];for(var n in k)k[n].id!=a&&e.push(k[n]);k=e},T=this.find(C),q=this.find(D),S=this.find(p),I=this.find("div.ajaxDropDownButtons"),L='<li class="ajaxDropDownLoading';""!==n.locl&&(L+=" "+n.locl),L+='"',""!==n.lost&&(L+=b+n.lost+'"'),L+=">"+n.prba+h;var M=m;""!==n.hecl&&(M+=" "+n.hecl),M+='"',""!==n.hest&&(M+=b+n.hest+'"'),M+=">";var U=n.loca.mcha.replace(/{NUM}/g,n.minq),A=m;""!==n.ercl&&(A+=" "+n.ercl),A+='"',""!==n.erst&&(A+=b+n.erst+'"'),A+=">"+n.loca.erro+h;var E=m;""!==n.nrcl&&(E+=" "+n.nrcl),E+='"',""!==n.nrst&&(E+=b+n.nrst+'"'),E+=">"+n.loca.nrec+h;var F=function(){if(0===T.find(g).length){var e=S.data("page");e=1*e;var s=!1,o=M+n.pabe+'<span class="ajaxDropDownPageNumber">'+e+'</span>/<span class="ajaxDropDownTotalPages">1</span>',d=o;d+=n.paen+n.loca.allr+'</li><li class="divider"></li>'+L;var p=q.val();p.length>0?p.length>=n.minq?(d=o,d+=n.paen+n.loca.rcon+" <strong>"+p,d+='</strong></li><li class="divider"></li>'+L,s=!0):d=M+U+h:s=!0,T.html(d),s&&a.post(n.url,{query:p,page:e}).fail(function(){T.append(A)}).done(function(e){var s=a.parseJSON(e);if(void 0===s.total&&(s.total=1),void 0===s.page&&(s.page=1),s.data.length){T.find("span.ajaxDropDownTotalPages").text(s.total);for(i in s.data){var o=w+s.page+r+s.data[i].id;""!==n.recl&&(o+=" "+n.recl),T.parent().parent().parent().find(x+s.data[i].id).length&&(o+=" "+t),o+='"',""!==n.rest&&(o+=b+n.rest+'"'),o+=c+s.data[i].id+'">',s.data[i].mark&&(o+=n.mabe),o+=s.data[i].value,s.data[i].mark&&(o+=n.maen),o+=l,T.append(o)}if(s.total>1){var d='<li class="divider ajaxDropDownInfo"></li><li class="ajaxDropDownInfo';""!==n.swcl&&(d+=" "+n.swcl),d+='"',""!==n.swst&&(d+=b+n.swst+'"'),d+='><a href="#" class="ajaxDropDownPrev',""!==n.prcl&&(d+=" "+n.prcl),1===s.page&&(d+=" "+f),d+='"',""!==n.prst&&(d+=b+n.prst+'"'),d+=">"+n.prbe+n.loca.prev+n.pren+'</a><a href="#" class="ajaxDropDownNext',""!==n.necl&&(d+=" "+n.necl),s.page===s.total&&(d+=" "+f),d+='"',""!==n.nest&&(d+=b+n.nest+'"'),d+=">"+n.nebe+n.loca.next+n.neen+l,T.append(d)}}else T.append(E)}).always(function(){a("li.ajaxDropDownLoading").remove()})}};return this.on("show.bs.dropdown",F),this.on("click",s,function(e){e.preventDefault(),e.stopPropagation(),T.find(o).removeClass(f),T.find(s).addClass(f);var i=S.data("page");if(i=1*i+1,T.find(u+i).length)T.find(g).addClass(v),T.find(u+i).removeClass(v),T.find(s).removeClass(f);else{var d=q.val();a.post(n.url,{query:d,page:i}).fail(function(){T.append(A)}).done(function(e){var o=a.parseJSON(e);if(o.data.length){T.find(g).addClass(v),void 0===o.total&&(o.total=1),void 0===o.page&&(o.page=1);for(var d in o.data){var p=w+o.page+r+o.data[d].id;""!==n.recl&&(p+=" "+n.recl),T.parent().parent().parent().find(x+o.data[d].id).length&&(p+=" "+t),p+='"',""!==n.rest&&(p+=b+n.rest+'"'),p+=c+o.data[d].id+'">',o.data[d].mark&&(p+=n.mabe),p+=o.data[d].value,o.data[d].mark&&(p+=n.maen),p+=l,T.find(".divider.ajaxDropDownInfo").before(p)}o.page<o.total?T.find(s).removeClass(f):i=o.total}else T.append(E)})}S.data("page",i),T.find(j).text(i)}),this.on("click",o,function(a){a.preventDefault(),a.stopPropagation(),T.find(s).removeClass(f),T.find(o).addClass(f);var e=S.data("page");e=1*e-1,1>e&&(e=1),T.find(g).addClass(v),T.find(u+e).removeClass(v),e>1&&T.find(o).removeClass(f),S.data("page",e),T.find(j).text(e)}),this.on("keyup",D,function(){window.clearTimeout(y),a(this).parent().find(p).data("page",1),a(this).parent().find(C).find(g).remove(),n.keyt&&(y=window.setTimeout(function(){I.addClass("open"),F()},n.dely))}),this.on("click","a.ajaxDropDownResult",function(e){e.preventDefault();var r=a(this).data("id"),l=a(this).html(),s=a(this).parent().parent().parent().parent().parent().find("ul.ajaxDropDownResults"),o="[]";if(n.smod&&(s.html(""),a(this).parent().parent().find(g).removeClass(t),o=""),n.smod&&""===n.addc&&!n.smbt){var i=a(this).parent().parent().parent().find(d);S.hide(),i.show(),q.val(l.replace(/<.*?>/g,"").replace(/"/g,"'")),q.prop("disabled",!0),q.after('<input class="singleResult" type="hidden" name="'+n.name+'" value="'+r+'">'),k.push({id:r,label:l}),R(r,l,k)}else if(a(this).parent().hasClass(t))a(this).parent().removeClass(t),s.find(x+r).remove(),N(r),P(r,k);else{a(this).parent().addClass(t);var p='<li class="ajaxDropDownSelected'+r;if(""!==n.rscl&&(p+=" "+n.rscl),p+='"',""!==n.rsst&&(p+=b+n.rsst+'"'),p+='><a href="#" class="ajaxDropDownRemove',""!==n.rmcl&&(p+=" "+n.rmcl),p+='"',""!==n.rmst&&(p+=b+n.rmst+'"'),p+=' data-id="'+r+'">'+n.rmla+"</a>",""!==n.addc){var c=n.addc.replace(/{ID}/g,r);c=c.replace(/{VALUE}/g,l),p+=c}p+=l+'<input type="hidden" name="'+n.name+o+'" value="'+r+'"></li>',s.append(p),k.push({id:r,label:l}),R(r,l,k)}}),this.on("click","a.ajaxDropDownRemove",function(e){e.preventDefault();var n=a(this).data("id");a(this).parent().parent().parent().find("li.ajaxDropDownRecord"+n).removeClass(t),a(this).parent().remove(),N(n),P(n,k)}),this.on("click",d,function(e){e.preventDefault();var n=a(this).parent().parent().find("input.singleResult"),t=n.val();n.remove(),q.prop("disabled",!1),q.val(""),a(this).hide(),S.show(),N(t),P(t,k)}),this}}(jQuery);