/*!
 * AjaxDropDown v1.3.3 | Pawe≈Ç Bizley Brzozowski | https://github.com/bizley/Yii2-AjaxDropDown
 */
!function(e){e.fn.ajaxDropDown=function(a){let t=e.extend(!0,{addc:"",dely:300,ercl:"",erst:"",hecl:"",hest:"",jsev:!0,keyt:!0,locl:"",lost:"",mabe:"",maen:"",minq:0,name:"ajaxDropDown",nebe:"",necl:"",neen:"",nest:"",nrcl:"",nrst:"",onrm:"",onsl:"",pabe:"",paen:"",prbe:"",prcl:"",pren:"",prst:"",prba:"",recl:"",rest:"",rmcl:"",rmla:"",rmst:"",rscl:"",rsst:"",smbt:!1,smod:!1,swcl:"",swst:"",url:"",loca:{allr:"All records",rcon:"Records containing",mcha:"Type at least {NUM} character(s) to filter the results...",erro:"Error",prev:"prev",next:"next",nrec:"No matching records found"}},a),n="active",l=" ajaxDropDownRecord",s="</a></li>",o="a.ajaxDropDownNext",i="a.ajaxDropDownPrev",r="button.ajaxDropDownSingleRemove",d="button.ajaxDropDownToggle",p='><a href="#" class="ajaxDropDownResult" data-id="',c="disabled",f="hidden",m="</li>",u='<li class="dropdown-header',h="li.ajaxDropDownPage",D="li.ajaxDropDownPages",g='<li class="ajaxDropDownPages ajaxDropDownPage',v="li.ajaxDropDownSelected",w="span.ajaxDropDownPageNumber",x=' style="',j="ul.ajaxDropDownMenu",b=null,y=[],C=new Function("id","selection",t.onrm),R=new Function("id","label","selection",t.onsl),N=function(e){let a=[];for(let t in y)y[t].id!=e&&a.push(y[t]);y=a},k=function(e){for(let a in y)if(y[a].id==e)return!0;return!1},P=this.find("ul.ajaxDropDownResults"),S=this.find(r),T=this.find(j),q=this.find("input[type=text]"),I=this.find(d),A=this.find("div.ajaxDropDownButtons"),L='<li class="ajaxDropDownLoading';""!==t.locl&&(L+=" "+t.locl),L+='"',""!==t.lost&&(L+=x+t.lost+'"'),L+=">"+t.prba+m;let U=u;""!==t.hecl&&(U+=" "+t.hecl),U+='"',""!==t.hest&&(U+=x+t.hest+'"'),U+=">";let E=t.loca.mcha.replace(/{NUM}/g,t.minq),M=u;""!==t.ercl&&(M+=" "+t.ercl),M+='"',""!==t.erst&&(M+=x+t.erst+'"'),M+=">"+t.loca.erro+m;let O=u;""!==t.nrcl&&(O+=" "+t.nrcl),O+='"',""!==t.nrst&&(O+=x+t.nrst+'"'),O+=">"+t.loca.nrec+m;let Q=function(){if(0===T.find(D).length){let a=I.data("page");a*=1;let o=!1,i=U+t.pabe+'<span class="ajaxDropDownPageNumber">'+a+'</span>/<span class="ajaxDropDownTotalPages">1</span>',r=i;r+=t.paen+t.loca.allr+'</li><li class="divider"></li>'+L;let d=q.val();d.length>0?d.length>=t.minq?(r=i,r+=t.paen+t.loca.rcon+" <strong>"+d,r+='</strong></li><li class="divider"></li>'+L,o=!0):r=U+E+m:o=!0,T.html(r),o&&e.post(t.url,{query:d,page:a}).fail(function(){T.append(M),console.log("jQuery post failed")}).done(function(a){let o=e.parseJSON(a);if(void 0===o.total&&(o.total=1),void 0===o.page&&(o.page=1),void 0===o.data)T.append(M),console.log("No data element in results object",a);else if(o.data.length){T.find("span.ajaxDropDownTotalPages").text(o.total);for(let e in o.data){let a=g+o.page+l+o.data[e].id;""!==t.recl&&(a+=" "+t.recl),T.parent().parent().parent().find(v+o.data[e].id).length&&(a+=" "+n),a+='"',""!==t.rest&&(a+=x+t.rest+'"'),a+=p+o.data[e].id+'">',o.data[e].mark&&(a+=t.mabe),a+=o.data[e].value,o.data[e].mark&&(a+=t.maen),a+=s,T.append(a)}if(o.total>1){let e='<li class="divider ajaxDropDownInfo"></li><li class="ajaxDropDownInfo';""!==t.swcl&&(e+=" "+t.swcl),e+='"',""!==t.swst&&(e+=x+t.swst+'"'),e+='><a href="#" class="ajaxDropDownPrev',""!==t.prcl&&(e+=" "+t.prcl),1===o.page&&(e+=" "+c),e+='"',""!==t.prst&&(e+=x+t.prst+'"'),e+=">"+t.prbe+t.loca.prev+t.pren+'</a><a href="#" class="ajaxDropDownNext',""!==t.necl&&(e+=" "+t.necl),o.page===o.total&&(e+=" "+c),e+='"',""!==t.nest&&(e+=x+t.nest+'"'),e+=">"+t.nebe+t.loca.next+t.neen+s,T.append(e)}}else T.append(O)}).always(function(){e("li.ajaxDropDownLoading").remove()})}};return this.on("show.bs.dropdown",Q),this.on("click",o,function(a){a.preventDefault(),a.stopPropagation(),T.find(i).removeClass(c),T.find(o).addClass(c);let r=I.data("page");if(r=1*r+1,T.find(h+r).length)T.find(D).addClass(f),T.find(h+r).removeClass(f),T.find(o).removeClass(c);else{let a=q.val();e.post(t.url,{query:a,page:r}).fail(function(){T.append(M),console.log("jQuery post failed")}).done(function(a){let i=e.parseJSON(a);if(void 0===i.data)T.append(M),console.log("No data element in results object",a);else if(i.data.length){T.find(D).addClass(f),void 0===i.total&&(i.total=1),void 0===i.page&&(i.page=1);for(let e in i.data){let a=g+i.page+l+i.data[e].id;""!==t.recl&&(a+=" "+t.recl),T.parent().parent().parent().find(v+i.data[e].id).length&&(a+=" "+n),a+='"',""!==t.rest&&(a+=x+t.rest+'"'),a+=p+i.data[e].id+'">',i.data[e].mark&&(a+=t.mabe),a+=i.data[e].value,i.data[e].mark&&(a+=t.maen),a+=s,T.find(".divider.ajaxDropDownInfo").before(a)}i.page<i.total?T.find(o).removeClass(c):r=i.total}else T.append(O)})}I.data("page",r),T.find(w).text(r)}),this.on("click",i,function(e){e.preventDefault(),e.stopPropagation(),T.find(o).removeClass(c),T.find(i).addClass(c);let a=I.data("page");(a=1*a-1)<1&&(a=1),T.find(D).addClass(f),T.find(h+a).removeClass(f),a>1&&T.find(i).removeClass(c),I.data("page",a),T.find(w).text(a)}),this.on("keyup","input[type=text]",function(){window.clearTimeout(b),e(this).parent().find(d).data("page",1),e(this).parent().find(j).find(D).remove(),t.keyt&&(b=window.setTimeout(function(){A.addClass("open"),Q()},t.dely))}),this.on("click","a.ajaxDropDownResult",function(a){a.preventDefault();let l=e(this).data("id"),s=e(this).html(),o="[]";if(t.smod&&(P.html(""),y=[],e(this).parent().parent().find(D).removeClass(n),o=""),t.smod&&""===t.addc&&!t.smbt)I.hide(),S.show(),q.val(s.replace(/<.*?>/g,"").replace(/"/g,"'")),q.prop("disabled",!0),q.parent().find(".singleResult").length?q.parent().find(".singleResult").val(l):q.after('<input class="singleResult" type="hidden" name="'+t.name+'" value="'+l+'">'),y.push({id:l,label:s}),R(l,s,y);else if(e(this).parent().hasClass(n))e(this).parent().removeClass(n),P.find(v+l).remove(),N(l),C(l,y);else{e(this).parent().addClass(n);let a='<li class="ajaxDropDownSelected'+l;if(""!==t.rscl&&(a+=" "+t.rscl),a+='"',""!==t.rsst&&(a+=x+t.rsst+'"'),a+='><a href="#" class="ajaxDropDownRemove',""!==t.rmcl&&(a+=" "+t.rmcl),a+='"',""!==t.rmst&&(a+=x+t.rmst+'"'),a+=' data-id="'+l+'">'+t.rmla+"</a>",""!==t.addc){let e=t.addc.replace(/{ID}/g,l);a+=e=e.replace(/{VALUE}/g,s)}a+=s+'<input type="hidden" name="'+t.name+o+'" value="'+l+'"></li>',P.append(a),y.push({id:l,label:s}),R(l,s,y)}}),this.on("click","a.ajaxDropDownRemove",function(a){a.preventDefault();let t=e(this).data("id");e(this).parent().parent().parent().find("li.ajaxDropDownRecord"+t).removeClass(n),e(this).parent().remove(),N(t),C(t,y)}),this.on("click",r,function(a){a.preventDefault();let t=e(this).parent().parent().find("input.singleResult"),n=t.val();t.remove(),q.prop("disabled",!1),q.val(""),e(this).hide(),I.show(),N(n),C(n,y)}),this.on("add",function(){let e="[]";t.smod&&(P.html(""),y=[],e="");for(let a in arguments)if(0!=a)if(void 0===arguments[a].id)console.log("No id element in data object",arguments[a]);else{let n=arguments[a].id;if(!k(n)){let l="";void 0!==arguments[a].value&&(l=arguments[a].value);let s=0;1==arguments[a].mark&&(s=1),s&&(l=t.mabe+l+t.maen);let o=t.addc;if(!1===arguments[a].additional?o="":void 0!==arguments[a].additional&&(o=arguments[a].additional),t.smod&&""===t.addc&&!t.smbt)I.hide(),S.show(),q.val(l.replace(/<.*?>/g,"").replace(/"/g,"'")),q.prop("disabled",!0),q.parent().find(".singleResult").length?q.parent().find(".singleResult").val(n):q.after('<input class="singleResult" type="hidden" name="'+t.name+'" value="'+n+'">'),y.push({id:n,label:l}),t.jsev&&R(n,l,y);else{let a='<li class="ajaxDropDownSelected'+n;if(""!==t.rscl&&(a+=" "+t.rscl),a+='"',""!==t.rsst&&(a+=x+t.rsst+'"'),a+='><a href="#" class="ajaxDropDownRemove',""!==t.rmcl&&(a+=" "+t.rmcl),a+='"',""!==t.rmst&&(a+=x+t.rmst+'"'),a+=' data-id="'+n+'">'+t.rmla+"</a>",""!==o){let e=o.replace(/{ID}/g,n);a+=e=e.replace(/{VALUE}/g,l)}a+=l+'<input type="hidden" name="'+t.name+e+'" value="'+n+'"></li>',t.smbt||(P.append(a),y.push({id:n,label:l}),t.jsev&&R(n,l,y))}}}t.smbt}),this.on("removeOne",function(){for(let e in arguments)if(0!=e)if(isNaN(arguments[e]))console.log("id is not a number",arguments[e]);else{let a=arguments[e];k(a)&&(P.find(v+a).remove(),N(a),t.jsev&&C(a,y))}}),this.on("removeAll",function(){P.html(""),y=[]}),this}}(jQuery);
